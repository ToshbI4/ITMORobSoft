#!/bin/bash 
# на строчку выше последовательность шебанг (#!) после которой идет имя файла программы-#интерпретатора

# Функция поиска файлов в определенной директории
file_info () {

    # Выбираем разделитилем символ перевода строки
    IFS=$'\n'
    
    # В цикле проходимся по каждому имени из вывода команды ls
    for unit in $(ls $1) 
    do
	# Если попалась директория, рекурсивно запускаем функцию поиска файлов в ней
	if [ -d "$1/$unit" ]; then
	echo "$1/$unit"
	file_info "$1/$unit"
     	#Иначе выводим информацию о файле
	else
	    # Для медиа-файлов имеющих определенную длительность, команда сохранит длительность
            time="$(ffmpeg -i $1"/"$unit 2>&1 | grep Duration | awk '{print $2}' | tr -d ,)"
	    #Если хотим избежать вывода N/A для изображений в поле "duration"
	    if [ "$time" == "N/A" ]
	    then
		time=""
	    fi 		
            # Собираем все данные для файла в одну строку
	    full=${unit%.*}","${unit##*"${unit%.*}"}","$(stat -c '%s, %z' $1"/""$unit")","$time
	    # Записываем эту строку в файл
            echo $full >> lab1.csv
	fi
    done
}

# Записываем шапку таблицы
echo "name, format, size(b), date, duration" > lab1.csv
file_info "$(pwd)"
